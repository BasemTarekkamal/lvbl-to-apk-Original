name: Build APK from URL

on:
  workflow_dispatch:
    inputs:
      url:
        description: 'The full Website URL (including https://)'
        required: true
        default: 'https://clinc-os.lovable.app'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Java (JDK 17)
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install Bubblewrap CLI
        run: npm install -g @bubblewrap/cli

      - name: Initialize Project
        run: |
          echo "Building for URL: ${{ github.event.inputs.url }}"
          
          # We use 'yes |' to accept the JDK/Android SDK licenses and installation prompts automatically.
          # We pass flags for the App ID so 'yes' doesn't accidentally answer the configuration questions.
          
          yes | bubblewrap init --manifest="${{ github.event.inputs.url }}" \
            --directory="." \
            --applicationId="com.app.generated" \
            --chromeFallbackPackage="com.android.chrome" \
            --answer

      - name: Build APK
        run: bubblewrap build

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: app-release
          path: |
            *.apk
            *.aab
